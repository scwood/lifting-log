import{f as oe,a as ie,R as ae,$ as le,W as t,X as f,a0 as c,a1 as $,h as X,r as D,B as de,Y as q,Z as ce}from"./index-f961dd02.js";import{W as k,C as V,T as z,E as C,b as G,d as ue}from"./workoutUtils-4417f5b3.js";import{d as ee,u as _,v as R,R as U,N as T,M as F,i as te,e as J,j as me,k as pe,f as ne,D as se,g as he,h as xe}from"./formUtils-23612ba6.js";import{B as I}from"./Button-7a6b00de.js";const ge={},B=oe((n,e)=>{const r=ie("TextInput",ge,n);return ae.createElement(ee,{component:"input",ref:e,...r,__staticSelector:"TextInput"})});B.classes=ee.classes;B.displayName="@mantine/core/TextInput";var Y=le("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),p=[];for(var L=0;L<256;++L)p.push((L+256).toString(16).slice(1));function fe(n,e=0){return(p[n[e+0]]+p[n[e+1]]+p[n[e+2]]+p[n[e+3]]+"-"+p[n[e+4]]+p[n[e+5]]+"-"+p[n[e+6]]+p[n[e+7]]+"-"+p[n[e+8]]+p[n[e+9]]+"-"+p[n[e+10]]+p[n[e+11]]+p[n[e+12]]+p[n[e+13]]+p[n[e+14]]+p[n[e+15]]).toLowerCase()}var O,we=new Uint8Array(16);function je(){if(!O&&(O=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!O))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return O(we)}var ye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const K={randomUUID:ye};function Z(n,e,r){if(K.randomUUID&&!e&&!n)return K.randomUUID();n=n||{};var s=n.random||(n.rng||je)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){r=r||0;for(var o=0;o<16;++o)e[r+o]=s[o];return e}return fe(s)}function ve(n){const{initialValues:e,onSave:r}=n,s=_({mode:"uncontrolled",initialValues:{type:(e==null?void 0:e.type)??k.Percentage,reps:(e==null?void 0:e.reps)??0,value:(e==null?void 0:e.value)??0},validate:{reps:R,value:R}}),o=s.onSubmit(i=>{r(e?{...e,...i}:{id:Z(),...i})}),l=s.getValues().type;return t.jsxs("form",{onSubmit:i=>{i.stopPropagation(),o(i)},children:[t.jsxs(f,{direction:"column",gap:"sm",children:[t.jsx(U.Group,{withAsterisk:!0,label:"Type",description:"Warm-up sets can be a fixed weight (e.g. 45 lbs) or a percentage of the working weight (e.g. 60%).",...s.getInputProps("type"),children:t.jsxs(f,{direction:"column",gap:"xs",mt:"xs",children:[t.jsx(U,{value:k.Percentage,label:"Percentage of working weight"}),t.jsx(U,{value:k.Weight,label:"Fixed weight"})]})},s.key("type")),t.jsx(T,{withAsterisk:!0,allowDecimal:!1,allowNegative:!1,label:"Reps",description:"Number of reps for the set",placeholder:l===k.Percentage?"5":"10",...s.getInputProps("reps")},s.key("reps")),t.jsx(T,{withAsterisk:!0,allowDecimal:!1,allowNegative:!1,max:l===k.Percentage?100:void 0,placeholder:l===k.Percentage?"60":"45",description:l===k.Percentage?"Percentage of working weight (1-100)":"Weight for the set",label:l===k.Percentage?"Percentage":"Weight",...s.getInputProps("value")},s.key("value"))]}),t.jsx(f,{justify:"flex-end",mt:"lg",children:t.jsx(I,{color:"green",type:"submit",children:"Save"})})]})}function De(n){const{warmUpSet:e,moveUpDisabled:r,moveDownDisabled:s,onEdit:o,onDelete:l,onMoveUp:i,onMoveDown:b}=n;return t.jsx(V,{children:t.jsxs(f,{justify:"space-between",align:"center",children:[t.jsxs(z,{size:"sm",children:[e.reps," rep",e.reps!==1&&"s"," with"," ",e.value,e.type===k.Percentage&&"% of working weight"]}),t.jsxs(c,{children:[t.jsx(c.Target,{children:t.jsx($,{variant:"subtle",color:"gray",children:t.jsx(Y,{style:{width:X(16),height:X(16)}})})}),t.jsxs(c.Dropdown,{children:[t.jsx(c.Item,{disabled:r,onClick:()=>i(e),children:"Move up"}),t.jsx(c.Item,{disabled:s,onClick:()=>b(e),children:"Move down"}),t.jsx(c.Item,{onClick:()=>o(e),children:"Edit"}),t.jsx(c.Item,{color:"red",onClick:()=>l(e),children:"Delete"})]})]})]})})}function be(n,e,r){const s=[...n],o=s[e];return s[e]=s[r],s[r]=o,s}function H(n,e,r){const s=n.findIndex(e),o=r==="up"?0:n.length-1;if(s===-1||s===o)return n;const l=r==="up"?s-1:s+1;return be(n,s,l)}function ke(n){const{form:e}=n,r=Object.values(e.errors);return r.length===0?null:t.jsxs(z,{c:"red.8",fz:"small",children:["Please correct the highlighted field",r.length>1?"s":"","."]})}function Q(n){const{opened:e,itemName:r,onClose:s,onDelete:o}=n;return t.jsxs(F,{centered:!0,title:`Delete ${r}`,opened:e,onClose:s,children:["Are you sure you want to permanently delete this ",r,"?",t.jsxs(f,{justify:"flex-end",gap:"xs",mt:"lg",children:[t.jsx(I,{variant:"default",onClick:s,children:"Cancel"}),t.jsx(I,{color:"red",onClick:l,children:"Delete"})]})]});function l(){o(),s()}}function Ie(n){const{initialValues:e,onSave:r}=n,[s,o]=D.useState((e==null?void 0:e.warmUpSets)??[]),[l,i]=D.useState(!1),[b,E]=D.useState(!1),[j,v]=D.useState(null),d=_({mode:"uncontrolled",initialValues:{name:(e==null?void 0:e.name)??"",weight:(e==null?void 0:e.weight)??0,sets:(e==null?void 0:e.sets)??0,reps:(e==null?void 0:e.reps)??0,type:(e==null?void 0:e.type)??C.DoublePlate,minimumWeightIncrement:(e==null?void 0:e.minimumWeightIncrement)??0},validate:{name:te,weight:R,sets:J,reps:J,minimumWeightIncrement:R}}),W=d.onSubmit(a=>{r(e?{...e,...a,warmUpSets:s,minimumWeightIncrement:h()}:{...a,id:Z(),warmUpSets:s,workingSets:{},nextSession:{},minimumWeightIncrement:h()})});return t.jsxs("form",{onSubmit:W,children:[t.jsxs(f,{direction:"column",gap:"sm",children:[t.jsx(B,{withAsterisk:!0,label:"Name",description:"Name of the exercise",placeholder:"Bench press",...d.getInputProps("name")},d.key("name")),t.jsx(T,{withAsterisk:!0,label:"Weight",description:"Your current working weight for the exercise",placeholder:"150",allowNegative:!1,allowDecimal:!0,...d.getInputProps("weight")},d.key("weight")),t.jsx(T,{withAsterisk:!0,label:"Sets",placeholder:"3",description:"Number of working sets you aim to complete currently",allowNegative:!1,allowDecimal:!1,...d.getInputProps("sets")},d.key("sets")),t.jsx(T,{withAsterisk:!0,label:"Reps",placeholder:"5",description:"Number of reps you aim to complete currently",allowNegative:!1,allowDecimal:!1,...d.getInputProps("reps")},d.key("reps")),t.jsx(U.Group,{withAsterisk:!0,name:"exerciseType",label:"Exercise type",description:"This field tells the app how to calculate warm-up sets. If your exercise uses plates, the app will tell you which plates to load.",...d.getInputProps("type"),children:t.jsxs(f,{direction:"column",gap:"xs",mt:"xs",children:[t.jsx(U,{value:C.DoublePlate,label:"Two sets of plates",description:"Use this for barbell exercises or machines that are weighted with plates on two sides (leg press, etc.)."}),t.jsx(U,{value:C.SinglePlate,label:"One set of plates",description:"Use this for exercises that are weighted with a single set of plates (weighted pull-ups, dips, etc.)"}),t.jsx(U,{value:C.Other,description:"Use this for exercises that are not weighted with plates (dumbbell, cable machines, bodyweight etc.)",label:"Other"})]})},d.key("type")),d.getValues().type===C.Other&&t.jsx(T,{withAsterisk:!0,allowDecimal:!0,ml:"xl",allowNegative:!1,placeholder:"5",label:"Minimum weight increment",description:"The smallest weight increment for the exercise (might be 5 for a dumbbell exercise, 2.5 for a certain machine, etc.)",...d.getInputProps("minimumWeightIncrement")},d.key("minimumWeightIncrement")),t.jsxs("div",{children:[t.jsx(me,{children:"Warm-up sets"}),t.jsx(pe,{children:"Optional warm-up sets for the exercise."})]}),s.map((a,x)=>t.jsx(De,{warmUpSet:a,moveUpDisabled:x===0,moveDownDisabled:x===s.length-1,onMoveUp:y=>P(y,"up"),onMoveDown:y=>P(y,"down"),onEdit:S,onDelete:N},a.id)),t.jsx(I,{onClick:w,children:"Add warm-up set"})]}),t.jsx(de,{mt:"lg",children:t.jsx(ke,{form:d})}),t.jsx(f,{justify:"flex-end",mt:"md",children:t.jsx(I,{type:"submit",color:"green",children:"Save"})}),t.jsx(F,{centered:!0,opened:l,onClose:()=>i(!1),title:`${j?"Edit":"Create"} warm-up set`,children:t.jsx(ve,{initialValues:j??void 0,onSave:u})}),t.jsx(Q,{opened:b,itemName:"warm-up set",onClose:()=>E(!1),onDelete:A})]});function w(){v(null),i(!0)}function S(a){v(a),i(!0)}function N(a){v(a),E(!0)}function A(){j&&o(a=>a.filter(x=>x.id!==j.id))}function P(a,x){o(y=>H(y,m=>m.id===a.id,x))}function u(a){i(!1),o(j?x=>x.map(y=>y.id===j.id?a:y):x=>[...x,a])}function h(){return d.getValues().type===C.DoublePlate?5:d.getValues().type===C.SinglePlate?2.5:d.getValues().minimumWeightIncrement}}function Se(n){const{exercise:e,moveDownDisabled:r,moveUpDisabled:s,onEdit:o,onDelete:l,onMoveDown:i,onMoveUp:b}=n;return t.jsxs(V,{withBorder:!0,children:[t.jsxs(f,{justify:"space-between",align:"center",children:[t.jsx(G,{order:4,children:e.name}),t.jsxs(c,{children:[t.jsx(c.Target,{children:t.jsx($,{variant:"subtle",color:"gray",children:t.jsx(Y,{})})}),t.jsxs(c.Dropdown,{children:[t.jsx(c.Item,{disabled:s,onClick:()=>b(e),children:"Move up"}),t.jsx(c.Item,{disabled:r,onClick:()=>i(e),children:"Move down"}),t.jsx(c.Item,{onClick:()=>o(e),children:"Edit"}),t.jsx(c.Item,{color:"red",onClick:()=>l(e),children:"Delete"})]})]})]}),t.jsxs(z,{c:"dimmed",size:"sm",children:[ue(e)," with ",e.warmUpSets.length," warm-up sets."]})]})}function Me(n){const{day:e,workout:r,moveDownDisabled:s,moveUpDisabled:o,onEdit:l,onDelete:i,onMoveDown:b,onMoveUp:E}=n,[j,v]=D.useState(!1),[d,W]=D.useState(!1),[w,S]=D.useState(null),{mutate:N}=ne();return t.jsxs("div",{children:[t.jsx(G,{order:3,children:t.jsxs(f,{justify:"space-between",align:"center",children:[t.jsxs("span",{children:["Day: ",e.name]}),t.jsxs(c,{children:[t.jsx(c.Target,{children:t.jsx($,{variant:"subtle",color:"gray",children:t.jsx(Y,{})})}),t.jsxs(c.Dropdown,{children:[t.jsx(c.Item,{disabled:o,onClick:()=>E(e),children:"Move up"}),t.jsx(c.Item,{disabled:s,onClick:()=>b(e),children:"Move down"}),t.jsx(c.Item,{onClick:()=>l(e),children:"Edit"}),t.jsx(c.Item,{color:"red",onClick:()=>i(e),children:"Delete"})]})]})]})}),t.jsx(se,{mt:4,mb:"md"}),t.jsxs(f,{direction:"column",gap:"md",children:[e.exercises.map((m,g)=>t.jsx(Se,{exercise:m,moveUpDisabled:g===0,moveDownDisabled:g===e.exercises.length-1,onEdit:A,onDelete:h,onMoveUp:M=>x(M,"up"),onMoveDown:M=>{x(M,"down")}},m.id)),t.jsx(I,{onClick:P,children:"Add exercise"})]}),t.jsx(F,{centered:!0,opened:j,onClose:()=>v(!1),title:`${w?"Edit":"Create"} exercise`,children:t.jsx(Ie,{initialValues:w??void 0,onSave:u},w==null?void 0:w.id)}),t.jsx(Q,{itemName:"exercise",opened:d,onClose:()=>W(!1),onDelete:a})]});function A(m){S(m),v(!0)}function P(){S(null),v(!0)}async function u(m){v(!1);let g;w?g=e.exercises.map(M=>M.id===w.id?m:M):g=[...e.exercises,m],await y(g)}function h(m){S(m),W(!0)}async function a(){if(!w)return;const m=e.exercises.filter(g=>g.id!==w.id);await y(m)}async function x(m,g){const M=H(e.exercises,re=>re.id===m.id,g);await y(M)}async function y(m){await N({workoutId:r.id,updates:{days:r.days.map(g=>g.id===e.id?{...g,exercises:m}:g)}})}}function Ce(n){const{initialValues:e,onSave:r}=n,s=_({mode:"uncontrolled",initialValues:{name:(e==null?void 0:e.name)??""},validate:{name:te}}),o=s.onSubmit(l=>{r(e?{...e,...l}:{id:Z(),exercises:[],...l})});return t.jsxs("form",{onSubmit:o,children:[t.jsx(B,{withAsterisk:!0,label:"Label",placeholder:"Monday",description:"Label for the day. For example: A, B, Monday, Tuesday, etc.",...s.getInputProps("name")},s.key("name")),t.jsx(f,{justify:"flex-end",mt:"lg",children:t.jsx(I,{type:"submit",color:"green",children:"Save"})})]})}function Te(){const[n,e]=D.useState(!1),[r,s]=D.useState(!1),[o,l]=D.useState(null),{data:i,isLoading:b,isError:E}=he(),{mutate:j}=ne(),{mutate:v,isPending:d}=xe();if(b)return t.jsx(q,{children:t.jsx(ce,{})});if(E)return t.jsx(q,{children:"Failed to load workout plan"});if(!i)return t.jsxs(f,{direction:"column",align:"center",gap:"sm",children:[t.jsx("div",{children:"Press the button below to create a workout plan"}),t.jsx(I,{color:"green",loading:d,onClick:()=>v({}),children:"Create workout plan"})]});return t.jsxs(t.Fragment,{children:[t.jsx(G,{mb:"sm",order:3,children:"Workout plan"}),t.jsxs(f,{direction:"column",gap:"lg",children:[i.days.map((u,h)=>t.jsx(Me,{day:u,workout:i,moveUpDisabled:h===0,moveDownDisabled:h===i.days.length-1,onEdit:N,onDelete:A,onMoveUp:a=>S(a,"up"),onMoveDown:a=>S(a,"down")},u.id)),t.jsx(se,{}),t.jsx(I,{onClick:P,children:"Add day"})]}),t.jsx(F,{title:`${o?"Edit":"Create"} day`,centered:!0,opened:n,onClose:()=>e(!1),children:t.jsx(Ce,{initialValues:o??void 0,onSave:W})}),t.jsx(Q,{itemName:"day",opened:r,onClose:()=>s(!1),onDelete:()=>w()})]});async function W(u){if(!i)return;e(!1);let h;o?h=i.days.map(a=>a.id===o.id?{...u}:a):h=[...i.days,u],await j({workoutId:i.id,updates:{days:h}})}async function w(){if(!i||!o)return;const u=i.days.filter(h=>h.id!==o.id);await j({workoutId:i.id,updates:{days:u}})}async function S(u,h){if(!i)return;const a=H(i.days,x=>x.id===u.id,h);await j({workoutId:i.id,updates:{days:a}})}function N(u){l(u),e(!0)}function A(u){l(u),s(!0)}function P(){l(null),e(!0)}}export{Te as default};
