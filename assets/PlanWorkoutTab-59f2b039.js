import{f as te,a as ne,R as se,$ as re,W as t,X as y,a0 as l,a1 as R,h as Y,r as U,B as oe,Y as Z,Z as ie}from"./index-e3e8204d.js";import{W as b,C as X,T as F,E as I,b as B,d as ae}from"./workoutUtils-fb67d43d.js";import{d as q,u as L,v as A,R as S,N as P,i as J,e as H,j as le,k as de,M as $,f as K,D as V,g as ce,h as ue}from"./formUtils-6ffa1718.js";import{B as E}from"./Button-95bc7bbd.js";const pe={},N=te((n,e)=>{const o=ne("TextInput",pe,n);return se.createElement(q,{component:"input",ref:e,...o,__staticSelector:"TextInput"})});N.classes=q.classes;N.displayName="@mantine/core/TextInput";var z=re("dots","IconDots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),u=[];for(var O=0;O<256;++O)u.push((O+256).toString(16).slice(1));function me(n,e=0){return(u[n[e+0]]+u[n[e+1]]+u[n[e+2]]+u[n[e+3]]+"-"+u[n[e+4]]+u[n[e+5]]+"-"+u[n[e+6]]+u[n[e+7]]+"-"+u[n[e+8]]+u[n[e+9]]+"-"+u[n[e+10]]+u[n[e+11]]+u[n[e+12]]+u[n[e+13]]+u[n[e+14]]+u[n[e+15]]).toLowerCase()}var T,he=new Uint8Array(16);function xe(){if(!T&&(T=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!T))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return T(he)}var ge=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Q={randomUUID:ge};function G(n,e,o){if(Q.randomUUID&&!e&&!n)return Q.randomUUID();n=n||{};var s=n.random||(n.rng||xe)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){o=o||0;for(var r=0;r<16;++r)e[o+r]=s[r];return e}return me(s)}function we(n){const{initialValues:e,onSave:o}=n,s=L({mode:"uncontrolled",initialValues:{type:(e==null?void 0:e.type)??b.Percentage,reps:(e==null?void 0:e.reps)??0,value:(e==null?void 0:e.value)??0},validate:{reps:A,value:A}}),r=s.onSubmit(c=>{o(e?{...e,...c}:{id:G(),...c})}),d=s.getValues().type;return t.jsxs("form",{onSubmit:c=>{c.stopPropagation(),r(c)},children:[t.jsxs(y,{direction:"column",gap:"sm",children:[t.jsx(S.Group,{withAsterisk:!0,label:"Type",description:"Warm-up sets can be a fixed weight (e.g. 45 lbs) or a percentage of the working weight (e.g. 60%).",...s.getInputProps("type"),children:t.jsxs(y,{direction:"column",gap:"xs",mt:"xs",children:[t.jsx(S,{value:b.Percentage,label:"Percentage of working weight"}),t.jsx(S,{value:b.Weight,label:"Fixed weight"})]})},s.key("type")),t.jsx(P,{withAsterisk:!0,allowDecimal:!1,allowNegative:!1,label:"Reps",description:"Number of reps for the set",placeholder:d===b.Percentage?"5":"10",...s.getInputProps("reps")},s.key("reps")),t.jsx(P,{withAsterisk:!0,allowDecimal:!1,allowNegative:!1,max:d===b.Percentage?100:void 0,placeholder:d===b.Percentage?"60":"45",description:d===b.Percentage?"Percentage of working weight (1-100)":"Weight for the set",label:d===b.Percentage?"Percentage":"Weight",...s.getInputProps("value")},s.key("value"))]}),t.jsx(y,{justify:"flex-end",mt:"lg",children:t.jsx(E,{color:"green",type:"submit",children:"Save"})})]})}function je(n){const{warmUpSet:e,moveUpDisabled:o,moveDownDisabled:s,onEdit:r,onDelete:d,onMoveUp:c,onMoveDown:g}=n;return t.jsx(X,{children:t.jsxs(y,{justify:"space-between",align:"center",children:[t.jsxs(F,{size:"sm",children:[e.reps," rep",e.reps!==1&&"s"," for"," ",e.value,e.type===b.Weight?"lbs":"% of working weight"]}),t.jsxs(l,{children:[t.jsx(l.Target,{children:t.jsx(R,{variant:"subtle",color:"gray",children:t.jsx(z,{style:{width:Y(16),height:Y(16)}})})}),t.jsxs(l.Dropdown,{children:[t.jsx(l.Item,{disabled:o,onClick:()=>c(e),children:"Move up"}),t.jsx(l.Item,{disabled:s,onClick:()=>g(e),children:"Move down"}),t.jsx(l.Item,{onClick:()=>r(e),children:"Edit"}),t.jsx(l.Item,{color:"red",onClick:()=>d(e),children:"Delete"})]})]})]})})}function ye(n,e,o){const s=[...n],r=s[e];return s[e]=s[o],s[o]=r,s}function _(n,e,o){const s=n.findIndex(e),r=o==="up"?0:n.length-1;if(s===-1||s===r)return n;const d=o==="up"?s-1:s+1;return ye(n,s,d)}function fe(n){const{form:e}=n,o=Object.values(e.errors);return o.length===0?null:t.jsxs(F,{c:"red.8",fz:"small",children:["Please correct the highlighted field",o.length>1?"s":"","."]})}function ve(n){const{initialValues:e,onSave:o}=n,[s,r]=U.useState((e==null?void 0:e.warmUpSets)??[]),[d,c]=U.useState(!1),[g,M]=U.useState(null),a=L({mode:"uncontrolled",initialValues:{name:(e==null?void 0:e.name)??"",weight:(e==null?void 0:e.weight)??0,sets:(e==null?void 0:e.sets)??0,reps:(e==null?void 0:e.reps)??0,type:(e==null?void 0:e.type)??I.DoublePlate,minimumWeightIncrement:(e==null?void 0:e.minimumWeightIncrement)??0},validate:{name:J,weight:A,sets:H,reps:H,minimumWeightIncrement:A}}),D=a.onSubmit(i=>{o(e?{...e,...i,warmUpSets:s,minimumWeightIncrement:m()}:{...i,id:G(),warmUpSets:s,workingSets:{},nextSession:{},minimumWeightIncrement:m()})});return t.jsxs("form",{onSubmit:D,children:[t.jsxs(y,{direction:"column",gap:"sm",children:[t.jsx(N,{withAsterisk:!0,label:"Name",description:"Name of the exercise",placeholder:"Bench press",...a.getInputProps("name")},a.key("name")),t.jsx(P,{withAsterisk:!0,label:"Weight",description:"Your current working weight for the exercise",placeholder:"150",allowNegative:!1,allowDecimal:!0,...a.getInputProps("weight")},a.key("weight")),t.jsx(P,{withAsterisk:!0,label:"Sets",placeholder:"3",description:"Number of working sets you aim to complete currently",allowNegative:!1,allowDecimal:!1,...a.getInputProps("sets")},a.key("sets")),t.jsx(P,{withAsterisk:!0,label:"Reps",placeholder:"5",description:"Number of reps you aim to complete currently",allowNegative:!1,allowDecimal:!1,...a.getInputProps("reps")},a.key("reps")),t.jsx(S.Group,{withAsterisk:!0,name:"exerciseType",label:"Exercise type",description:"This field tells the app how to calculate warm-up sets. If your exercise uses plates, the app will tell you which plates to load.",...a.getInputProps("type"),children:t.jsxs(y,{direction:"column",gap:"xs",mt:"xs",children:[t.jsx(S,{value:I.DoublePlate,label:"Two sets of plates",description:"Use this for barbell exercises or machines that are weighted with plates on two sides (leg press, etc.)."}),t.jsx(S,{value:I.SinglePlate,label:"One set of plates",description:"Use this for exercises that are weighted with a single set of plates (weighted pull-ups, dips, etc.)"}),t.jsx(S,{value:I.Other,description:"Use this for exercises that are not weighted with plates (dumbbell, cable machines, bodyweight etc.)",label:"Other"})]})},a.key("type")),a.getValues().type===I.Other&&t.jsx(P,{withAsterisk:!0,allowDecimal:!0,ml:"xl",allowNegative:!1,placeholder:"5",label:"Minimum weight increment",description:"The smallest weight increment for the exercise (might be 5 for a dumbbell exercise, 2.5 for a certain machine, etc.)",...a.getInputProps("minimumWeightIncrement")},a.key("minimumWeightIncrement")),t.jsxs("div",{children:[t.jsx(le,{children:"Warm-up sets"}),t.jsx(de,{children:"Optional warm-up sets for the exercise."})]}),s.map((i,h)=>t.jsx(je,{warmUpSet:i,moveUpDisabled:h===0,moveDownDisabled:h===s.length-1,onMoveUp:w=>W(w,"up"),onMoveDown:w=>W(w,"down"),onEdit:k,onDelete:C},i.id)),t.jsx(E,{onClick:f,children:"Add warm-up set"})]}),t.jsx(oe,{mt:"lg",children:t.jsx(fe,{form:a})}),t.jsx(y,{justify:"flex-end",mt:"md",children:t.jsx(E,{type:"submit",color:"green",children:"Save"})}),t.jsx($,{centered:!0,opened:d,onClose:()=>c(!1),title:`${g?"Edit":"Create"} warm-up set`,children:t.jsx(we,{initialValues:g??void 0,onSave:p})})]});function f(){M(null),c(!0)}function k(i){M(i),c(!0)}function C(i){r(h=>h.filter(w=>w.id!==i.id))}function W(i,h){r(w=>_(w,x=>x.id===i.id,h))}function p(i){c(!1),r(g?h=>h.map(w=>w.id===g.id?i:w):h=>[...h,i])}function m(){return a.getValues().type===I.DoublePlate?5:a.getValues().type===I.SinglePlate?2.5:a.getValues().minimumWeightIncrement}}function be(n){const{exercise:e,moveDownDisabled:o,moveUpDisabled:s,onEdit:r,onDelete:d,onMoveDown:c,onMoveUp:g}=n;return t.jsxs(X,{withBorder:!0,children:[t.jsxs(y,{justify:"space-between",align:"center",children:[t.jsx(B,{order:4,children:e.name}),t.jsxs(l,{children:[t.jsx(l.Target,{children:t.jsx(R,{variant:"subtle",color:"gray",children:t.jsx(z,{})})}),t.jsxs(l.Dropdown,{children:[t.jsx(l.Item,{disabled:s,onClick:()=>g(e),children:"Move up"}),t.jsx(l.Item,{disabled:o,onClick:()=>c(e),children:"Move down"}),t.jsx(l.Item,{onClick:()=>r(e),children:"Edit"}),t.jsx(l.Item,{color:"red",onClick:()=>d(e),children:"Delete"})]})]})]}),t.jsxs(F,{c:"dimmed",size:"sm",children:[ae(e)," with ",e.warmUpSets.length," warm-up sets."]})]})}function De(n){const{day:e,workout:o,moveDownDisabled:s,moveUpDisabled:r,onEdit:d,onDelete:c,onMoveDown:g,onMoveUp:M}=n,[a,D]=U.useState(!1),[f,k]=U.useState(null),{mutate:C}=K();return t.jsxs("div",{children:[t.jsx(B,{order:3,children:t.jsxs(y,{justify:"space-between",align:"center",children:[t.jsxs("span",{children:["Day: ",e.name]}),t.jsxs(l,{children:[t.jsx(l.Target,{children:t.jsx(R,{variant:"subtle",color:"gray",children:t.jsx(z,{})})}),t.jsxs(l.Dropdown,{children:[t.jsx(l.Item,{disabled:r,onClick:()=>M(e),children:"Move up"}),t.jsx(l.Item,{disabled:s,onClick:()=>g(e),children:"Move down"}),t.jsx(l.Item,{onClick:()=>d(e),children:"Edit"}),t.jsx(l.Item,{color:"red",onClick:()=>c(e),children:"Delete"})]})]})]})}),t.jsx(V,{mt:4,mb:"md"}),t.jsxs(y,{direction:"column",gap:"md",children:[e.exercises.map((x,j)=>t.jsx(be,{exercise:x,moveUpDisabled:j===0,moveDownDisabled:j===e.exercises.length-1,onEdit:W,onDelete:i,onMoveUp:v=>h(v,"up"),onMoveDown:v=>{h(v,"down")}},x.id)),t.jsx(E,{onClick:p,children:"Add exercise"})]}),t.jsx($,{centered:!0,opened:a,onClose:()=>D(!1),title:`${f?"Edit":"Create"} exercise`,children:t.jsx(ve,{initialValues:f??void 0,onSave:m},f==null?void 0:f.id)})]});function W(x){k(x),D(!0)}function p(){k(null),D(!0)}async function m(x){D(!1);let j;f?j=e.exercises.map(v=>v.id===f.id?x:v):j=[...e.exercises,x],await w(j)}async function i(x){const j=e.exercises.filter(v=>v.id!==x.id);await w(j)}async function h(x,j){const v=_(e.exercises,ee=>ee.id===x.id,j);await w(v)}async function w(x){await C({workoutId:o.id,updates:{days:o.days.map(j=>j.id===e.id?{...j,exercises:x}:j)}})}}function ke(n){const{initialValues:e,onSave:o}=n,s=L({mode:"uncontrolled",initialValues:{name:(e==null?void 0:e.name)??""},validate:{name:J}}),r=s.onSubmit(d=>{o(e?{...e,...d}:{id:G(),exercises:[],...d})});return t.jsxs("form",{onSubmit:r,children:[t.jsx(N,{withAsterisk:!0,label:"Label",placeholder:"Monday",description:"Label for the day. For example: A, B, Monday, Tuesday, etc.",...s.getInputProps("name")},s.key("name")),t.jsx(y,{justify:"flex-end",mt:"lg",children:t.jsx(E,{type:"submit",color:"green",children:"Save"})})]})}function Me(){const[n,e]=U.useState(!1),[o,s]=U.useState(null),{data:r,isLoading:d,isError:c}=ce(),{mutate:g}=K(),{mutate:M,isPending:a}=ue();if(d)return t.jsx(Z,{children:t.jsx(ie,{})});if(c)return t.jsx(Z,{children:"Failed to load workout plan"});if(!r)return t.jsxs(y,{direction:"column",align:"center",gap:"sm",children:[t.jsx("div",{children:"Press the button below to create a workout plan"}),t.jsx(E,{color:"green",loading:a,onClick:()=>M({}),children:"Create workout plan"})]});return t.jsxs(t.Fragment,{children:[t.jsx(B,{mb:"sm",order:3,children:"Workout plan"}),t.jsxs(y,{direction:"column",gap:"lg",children:[r.days.map((p,m)=>t.jsx(De,{day:p,workout:r,moveUpDisabled:m===0,moveDownDisabled:m===r.days.length-1,onEdit:C,onDelete:f,onMoveUp:i=>k(i,"up"),onMoveDown:i=>k(i,"down")},p.id)),t.jsx(V,{}),t.jsx(E,{onClick:W,children:"Add day"})]}),t.jsx($,{title:`${o?"Edit":"Create"} day`,centered:!0,opened:n,onClose:()=>e(!1),children:t.jsx(ke,{initialValues:o??void 0,onSave:D})})]});async function D(p){if(!r)return;e(!1);let m;o?m=r.days.map(i=>i.id===o.id?{...p}:i):m=[...r.days,p],await g({workoutId:r.id,updates:{days:m}})}async function f(p){if(!r)return;const m=r.days.filter(i=>i.id!==p.id);await g({workoutId:r.id,updates:{days:m}})}async function k(p,m){if(!r)return;const i=_(r.days,h=>h.id===p.id,m);await g({workoutId:r.id,updates:{days:i}})}function C(p){s(p),e(!0)}function W(){s(null),e(!0)}}export{Me as default};
